import { tiny } from '../tiny-graphics.js';
const { Shape, Vector3, vec3 } = tiny;


class TreeBark extends Shape {                                 
  constructor(topRatio = 0.5, useSmoothShading = true) { 
    super("position", "normal");                           
    this.arrays.position = Vector3.cast(
      [-1,0,0], [-.55,0,1], vec3(...[-1,1,0]).mix(vec3(0,1,0), topRatio),
      [-.55,0,1], vec3(...[-.55,1,1]).mix(vec3(0,1,0), topRatio), vec3(...[-1,1,0]).mix(vec3(0,1,0), topRatio),
      [-.55,0,1], [.55,0,1], vec3(...[-.55,1,1]).mix(vec3(0,1,0), topRatio),
      [.55,0,1], vec3(...[.55,1,1]).mix(vec3(0,1,0), topRatio), vec3(...[-.55,1,1]).mix(vec3(0,1,0), topRatio),
      [.55,0,1], [1,0,0], vec3(...[.55,1,1]).mix(vec3(0,1,0), topRatio),
      [1,0,0], vec3(...[1,1,0]).mix(vec3(0,1,0), topRatio), vec3(...[.55,1,1]).mix(vec3(0,1,0), topRatio),
      [1,0,0], [.55,0,-1], vec3(...[1,1,0]).mix(vec3(0,1,0), topRatio),
      [.55,0,-1], vec3(...[.55,1,-1]).mix(vec3(0,1,0), topRatio), vec3(...[1,1,0]).mix(vec3(0,1,0), topRatio),
      [.55,0,-1], [-.55,0,-1], vec3(...[.55,1,-1]).mix(vec3(0,1,0), topRatio),
      [-.55,0,-1], vec3(...[-.55,1,-1]).mix(vec3(0,1,0), topRatio), vec3(...[.55,1,-1]).mix(vec3(0,1,0), topRatio),
      [-.55,0,-1], [-1,0,0], vec3(...[-.55,1,-1]).mix(vec3(0,1,0), topRatio),
      [-1,0,0], vec3(...[-1,1,0]).mix(vec3(0,1,0), topRatio), vec3(...[-.55,1,-1]).mix(vec3(0,1,0), topRatio),
    );
    if (useSmoothShading) {
      this.arrays.normal = Vector3.cast(
        [-1,0,0], [-.55,0,1], [-1,0,0],
        [-.55,0,1], [-.55,0,1], [-1,0,0],
        [-.55,0,1], [.55,0,1], [-.55,0,1],
        [.55,0,1], [.55,0,1], [-.55,0,1],
        [.55,0,1], [1,0,0], [.55,0,1],
        [1,0,0], [1,0,0], [.55,0,1],
        [1,0,0], [.55,0,-1], [1,0,0],
        [.55,0,-1], [.55,0,-1], [1,0,0],
        [.55,0,-1], [-.55,0,-1], [.55,0,-1],
        [-.55,0,-1], [-.55,0,-1], [.55,0,-1],
        [-.55,0,-1], [-1,0,0], [-.55,0,-1],
        [-1,0,0], [-1,0,0], [-.55,0,-1],
      );
    } else {
      this.arrays.normal = Vector3.cast(
        [-.8,0,.45], [-.8,0,.45], [-.8,0,.45],
        [-.8,0,.45], [-.8,0,.45], [-.8,0,.45],
        [0,0,1], [0,0,1], [0,0,1],
        [0,0,1], [0,0,1], [0,0,1],
        [.8,0,.45], [.8,0,.45], [.8,0,.45],
        [.8,0,.45], [.8,0,.45], [.8,0,.45],
        [.8,0,-.45], [.8,0,-.45], [.8,0,-.45],
        [.8,0,-.45], [.8,0,-.45], [.8,0,-.45],
        [0,0,-1], [0,0,-1], [0,0,-1],
        [0,0,-1], [0,0,-1], [0,0,-1],
        [-.8,0,-.45], [-.8,0,-.45], [-.8,0,-.45],
        [-.8,0,-.45], [-.8,0,-.45], [-.8,0,-.45],
      );
    }
    
    
    this.arrays.normal = this.arrays.normal.map(normal => normal.normalized());
    console.log(this.arrays.normal)
  }
}

export default TreeBark;